<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>jQuery - Benchmark</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="http://code.jquery.com/jquery.js?n=hj" type="text/javascript"></script>
    <link type="text/css" rel="stylesheet" href="http://syntaxhighlighter.googlecode.com/svn-history/r86/trunk/Styles/SyntaxHighlighter.css"></link>
    <script language="javascript" src="http://syntaxhighlighter.googlecode.com/svn-history/r86/trunk/Scripts/shCore.js"></script>
    <script language="javascript" src="http://syntaxhighlighter.googlecode.com/svn-history/r86/trunk/Scripts/shBrushJScript.js"></script>
    <script src="jquery-benchmark.js" type="text/javascript"></script>
<script type="text/javascript" id="hej">
(function(){

I = 0;

/**
 * This is used for generating test code
 */
$.fn.extend({

  benchmark: function( prop ) {
    var time = $.benchmark.now(), l = this.length, i = 0;
    function make( r, elem ) {
      var self = $(elem),
      html = "",
      pre = I++ + "benchmark_",
      suf = r + "_" + time,
      id = {},
      ids = ["button", "message", "times", "textarea", "pre", "pre_div"],
      i = 0, l = ids.length;

      for(; i < l; id[ ids[ i ] ] = pre + ids[ i++ ] + suf ) {}

      html += "<div><h3>Code: " + ( prop.name ? prop.name : "" ) + "</h3>";

      if( prop.description ) {
        html += "<p>"+prop.description.replace("\n", "<br>")+"</p>";
      }

      html += "<div id='" + id.pre_div + "'><pre name='code' id='" + id.pre + "' class='jscript'>" + ( prop.test ? prop.test.toString() : "" ) + "</pre></div>";

      if( prop.tester ) {
        html += "<input type='text' id='" + id.times + "' size='5' value='100' />";
      }

      if( prop.type === "user-input" ) {
        html += "<textarea id='"+id.textarea+"' cols='100' rows='15'>" + ( prop.test ? prop.test.toString() : "" ) + "</textarea>";
      }

      html += "<input type='button' id='" + id.button + "' value='Run Code' />";
      html += "<div id='" + id.message + "'><div>";

      self.html(html);

      $("#"+id.button).click(function() {

        if( prop.type === "user-input" ) {
          var data = $("#"+id.textarea).val();
          $("#" + id.pre_div).html("<pre name='code' id='" + id.pre + "' class='jscript'>" + data + "</pre>");
          $("#" + id.pre).html(data);
          dp.SyntaxHighlighter.HighlightAll("code");
          eval(data);
        } else {
          if( prop.tester ) {
            var times = $("#"+id.times).val();
            $.benchmark.test(prop.test, times);
          } else {
            prop.test();
          }

        }
        $("#"+id.message).html( prop.output ? prop.output : $.benchmark.output() );

      });

    }

    for(; i < l; make( i, this[ i++ ] ) ) {}

    return this;
  }

});

})();


$(function(){

  for( var i = 1; i <= 7;) {
    $("body").append("<div id='input" + i++ + "' class='test'></div>");
  }

  var runTime;

  $('#input1').benchmark({

    description: "Making simple tests",

    test:
function() {
  // The most basic test, mark the start
  $.benchmark.start();
  // Run thus code 100 times
  for( var i = 0; i < 100; i++ ) {
    $("a").show().hide().show().hide();
    $('div').html();
  }
  // Mark the end and output the result,
  // since all benchmarker methods returns the object itself we need to write ".result()"
  // to return the result, this is later used to show the result below,
  // the only way i'm doing this is to show the result on the page, all result is being
  // written out in the console...
  runTime = $.benchmark.end().result();

},

    output: function() {
      return "runTime " + runTime + " ms <br><br>Console output:<br>" + $.benchmark.output();
    }

  });

  $('#input2').benchmark({

    description: "Using: $.benchmark.test()",

    test:
function(){
  // Here we creates a function that we pass into the function tester
  // The first parameter(the array), is the arguments that will be passed into the callback
  runTime = $.benchmark.test(['info'], function( n, i ) {

    // 'n' = 'info' every time and 'i' will do the current number in the loop
    $('body').html();

  // This says that it will run the function 100 times
  }, 100).result();

},

    output: function() {
      return "runTime " + runTime + " ms <br><br>Console output:<br>" + $.benchmark.output();
    }

  });

  $('#input3').benchmark({

    description: "Using: $.benchmark.test()",

    test:
function(){

  var testFunction = function(){
    $('div').hide();
    $('div').show();
  }
  // More or less the same test as above,
  // only here we aren't sending in any parameters
  // to the tester and we are creating the function before we do the test
  runTime = $.benchmark.test(testFunction, 100).result();

},

    output: function() {
      return "runTime " + runTime + " ms <br><br>Console output:<br>" + $.benchmark.output();
    }

  });

  $('#input4').benchmark({

    description: "Making more complex tests",

    test:
function() {
  // Mark the start of the main test
  $.benchmark.startTest("name of the test");

  // Preform a sub-test, that will be runned 1000 timess
  for( var i = 0; i < 1000; i++ ) {
    $.benchmark.start("show hide");
    $('div').hide();
    $('div').show();
    $.benchmark.end("show hide");

  // Preform another sub-test
    $.benchmark.start("html");
    $('div').html();
    $.benchmark.end("html");
  }

  // Mark the end of the test and output the result
  runTime = $.benchmark.endTest("name of the test").result();

},

    output: function() {
      return "runTime " + runTime + " ms <br><br>Console output:<br>" + $.benchmark.output();
    }

  });

  $('#input5').benchmark({

    description: "Setup tests using $.benchmark.setup",

    test:
function() {

  // Just create some dummie functions
  var test = function() {
    $("<div />").hide();
    $("<div />").show();
  }
  
  test.fn = function() {
    $("<div />").hide();
    $("<div />").show();
  }
  
  test.sub = {
    fn: function() {
      $("<div />").show().hide();
    }
  };
  
  // Setup tests for the "test" object and all the 
  // sub-functions with the $.benchmark.setup function.
  $.benchmark.setup( "test", test, true );
  
  // Do the test
  $.benchmark.startTest()
  
  var i = 1000;
  
  while( i-- ) {
    test.fn();
    test();
    test.sub.fn();
  }
  
  // Mark the end of the test and output the result
  runTime = $.benchmark.endTest().result();

},

    output: function() {
      return "runTime " + runTime + " ms <br><br>Console output:<br>" + $.benchmark.output();
    }

  });


  dp.SyntaxHighlighter.ClipboardSwf = 'http://syntaxhighlighter.googlecode.com/svn-history/r86/trunk/Scripts/clipboard.swf';
  dp.SyntaxHighlighter.HighlightAll('code');

});

</script>
<style type="text/css">

.test {
  margin-top: 20px;
  width: 800px;
  margin-left: auto;
  margin-right: auto;
  padding: 20px;
}

</style>
  </head>
  <body>

    <div><center><h2 style="margin-bottom: 0px">jQuery - Benchmark</h2>Author: Emil Kilhage</center></div>

  </body>
</html>
